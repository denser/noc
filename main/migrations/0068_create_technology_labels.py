# ----------------------------------------------------------------------
# Create utility labels labels
# ----------------------------------------------------------------------
# Copyright (C) 2007-2023 The NOC Project
# See LICENSE for details
# ----------------------------------------------------------------------

# Third-party modules
from pymongo import InsertOne

# NOC modules
from noc.core.migration.base import BaseMigration


class Migration(BaseMigration):
    def migrate(self):
        # Create wildcard labels
        l_coll = self.mongo_db["labels"]
        current_labels = {ll["name"]: ll["_id"] for ll in l_coll.find()}
        bulk = []
        if "technology::*" not in current_labels:
            bulk += [
                InsertOne(
                    {
                        "name": "technology::*",
                        "description": "Wildcard label for scope technology",
                        "bg_color1": 15105570,
                        "fg_color1": 16777215,
                        "bg_color2": 9807270,
                        "fg_color2": 16777215,
                        "display_order": 0,
                        "is_protected": False,
                        "is_autogenerated": False,
                        "is_matching": False,
                        "propagate": True,
                        "enable_agent": False,
                        "enable_interface": True,
                        "match_regex": [],
                        "match_vlanfilter": [],
                        "match_prefixfilter": [],
                    }
                )
            ]
        if bulk:
            l_coll.bulk_write(bulk, ordered=True)
